<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student MP3 Recorder</title>
    <link rel="manifest" href="manifest.json">
   
    <script src="https://unpkg.com/mic-recorder-to-mp3@2.2.2/dist/index.min.js"></script>

    <style>
        body { font-family: system-ui, -apple-system, sans-serif; text-align: center; padding: 2rem; background: #f0f4f8; color: #2c3e50; }
        .card { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 500px; margin: 0 auto; }
        .controls { display: flex; justify-content: center; gap: 1rem; margin-top: 2rem; }
        button { padding: 1rem 1.5rem; font-size: 1rem; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; transition: transform 0.1s, background 0.2s; }
        button:active { transform: scale(0.95); }
        #recordBtn { background: #e74c3c; color: white; }
        #recordBtn:hover { background: #c0392b; }
        #stopBtn { background: #7f8c8d; color: white; }
        #stopBtn:hover { background: #34495e; }
        button:disabled { background: #bdc3c7 !important; cursor: not-allowed; }
        .status-area { height: 30px; margin-top: 10px; }
        #status { color: #e74c3c; font-weight: bold; display: none; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.4; } 100% { opacity: 1; } }
        #audioList { margin-top: 2rem; }
        .audio-item { background: #ecf0f1; padding: 15px; border-radius: 10px; margin-bottom: 1rem; display: flex; flex-direction: column; align-items: center; gap: 10px; }
        audio { width: 100%; }
        .download-link { color: #3498db; text-decoration: none; font-weight: bold; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div class="card">
        <h1>üé§ Class Recorder</h1>
        <p>Record your voice and download as an MP3.</p>
       
        <div class="status-area">
            <div id="status">‚óè RECORDING</div>
        </div>
       
        <div class="controls">
            <button id="recordBtn">Start Recording</button>
            <button id="stopBtn" disabled>Stop & Save</button>
        </div>
    </div>

    <div id="audioList"></div>

    <script>
        // 1. Initialize the MP3 Encoder
        const recorder = new MicRecorder({ bitRate: 128 });

        const recordBtn = document.getElementById('recordBtn');
        const stopBtn = document.getElementById('stopBtn');
        const status = document.getElementById('status');
        const audioList = document.getElementById('audioList');

        // 2. Start Recording Logic
        recordBtn.onclick = () => {
            recorder.start().then(() => {
                recordBtn.disabled = true;
                stopBtn.disabled = false;
                status.style.display = 'block';
            }).catch((e) => {
                console.error(e);
                alert("Please allow microphone access to use this app.");
            });
        };

        // 3. Stop and Convert to MP3 Logic
        stopBtn.onclick = () => {
            recorder.stop().getMp3().then(([buffer, blob]) => {
                // Create the MP3 File
                const file = new File(buffer, 'student_recording.mp3', {
                    type: blob.type,
                    lastModified: Date.now()
                });

                // Create the UI elements for the new recording
                const audioUrl = URL.createObjectURL(file);
                const container = document.createElement('div');
                container.className = 'audio-item';
               
                const audio = document.createElement('audio');
                audio.src = audioUrl;
                audio.controls = true;

                const link = document.createElement('a');
                link.href = audioUrl;
                link.download = `recording_${new Date().toLocaleTimeString().replace(/:/g, '-')}.mp3`;
                link.className = 'download-link';
                link.innerText = "üíæ Download MP3 File";

                container.appendChild(audio);
                container.appendChild(link);
                audioList.prepend(container);

                // Reset buttons
                recordBtn.disabled = false;
                stopBtn.disabled = true;
                status.style.display = 'none';
            }).catch((e) => console.error(e));
        };

        // 4. Register Service Worker for PWA Offline Support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(err => console.log('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
